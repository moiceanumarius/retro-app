{% extends 'admin/base.html.twig' %}

{% block title %}Add User - Admin Panel{% endblock %}

{% block page_title %}Add User{% endblock %}

{% block page_subtitle %}
    <div class="admin-content-subtitle">Create a new user account with roles and permissions</div>
{% endblock %}

{% block body %}
<!-- Back Button -->
<div style="margin-bottom: 1.5rem; display: flex; justify-content: flex-end;">
    <a href="{{ path('admin_users') }}" class="admin-btn admin-btn-secondary">
        <i class="fas fa-arrow-left"></i>
        Back to Users
    </a>
</div>

<div>
    <div class="admin-card">
        <div class="admin-card-header">
            <h2 class="admin-card-title">
                <i class="fas fa-user-plus" style="margin-right: 0.5rem; color: var(--admin-primary);"></i>
                User Information
            </h2>
        </div>
        <div class="admin-card-body">
                <form method="post" id="userAddForm">
                    <!-- Personal Information Section -->
                    <div class="section-header" style="margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--admin-text-color); margin: 0 0 0.5rem 0;">
                            <i class="fas fa-user" style="margin-right: 0.5rem; color: var(--admin-primary);"></i>
                            Personal Information
                        </h2>
                        <p style="color: var(--admin-text-muted); margin: 0; font-size: 0.875rem;">Enter user's basic information and contact details</p>
                    </div>
                    
                    <div class="form-card" style="background: white; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid var(--admin-border-color); margin-bottom: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label for="firstName" class="admin-form-label">First Name <span style="color: var(--admin-danger);">*</span></label>
                                <input type="text" 
                                       class="admin-form-control" 
                                       id="firstName" 
                                       name="firstName" 
                                       placeholder="Enter first name"
                                       required>
                            </div>
                            <div>
                                <label for="lastName" class="admin-form-label">Last Name <span style="color: var(--admin-danger);">*</span></label>
                                <input type="text" 
                                       class="admin-form-control" 
                                       id="lastName" 
                                       name="lastName" 
                                       placeholder="Enter last name"
                                       required>
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <label for="email" class="admin-form-label">Email Address <span style="color: var(--admin-danger);">*</span></label>
                            <input type="email" 
                                   class="admin-form-control" 
                                   id="email" 
                                   name="email" 
                                   placeholder="Enter email address"
                                   required>
                        </div>
                    </div>

                    <!-- Password Section -->
                    <div class="section-header" style="margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--admin-text-color); margin: 0 0 0.5rem 0;">
                            <i class="fas fa-key" style="margin-right: 0.5rem; color: var(--admin-warning);"></i>
                            Password Setup
                        </h2>
                        <p style="color: var(--admin-text-muted); margin: 0; font-size: 0.875rem;">Set up a secure password for the new user account</p>
                    </div>
                    
                    <div class="form-card" style="background: white; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid var(--admin-border-color); margin-bottom: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label for="password" class="admin-form-label">Password <span style="color: var(--admin-danger);">*</span></label>
                                <input type="password" 
                                       class="admin-form-control" 
                                       id="password" 
                                       name="password" 
                                       placeholder="Enter password"
                                       minlength="6"
                                       required>
                                <div style="font-size: 0.75rem; color: var(--admin-text-muted); margin-top: 0.25rem;">
                                    <i class="fas fa-shield-alt" style="margin-right: 0.25rem;"></i>
                                    Password must be at least 6 characters long
                                </div>
                            </div>
                            <div>
                                <label for="confirmPassword" class="admin-form-label">Confirm Password <span style="color: var(--admin-danger);">*</span></label>
                                <input type="password" 
                                       class="admin-form-control" 
                                       id="confirmPassword" 
                                       name="confirmPassword" 
                                       placeholder="Confirm password"
                                       minlength="6"
                                       required>
                                <div style="font-size: 0.75rem; color: var(--admin-text-muted); margin-top: 0.25rem;">
                                    <i class="fas fa-check-circle" style="margin-right: 0.25rem;"></i>
                                    Must match the password above
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Status Section -->
                    <div class="section-header" style="margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--admin-text-color); margin: 0 0 0.5rem 0;">
                            <i class="fas fa-toggle-on" style="margin-right: 0.5rem; color: var(--admin-success);"></i>
                            Account Status
                        </h2>
                        <p style="color: var(--admin-text-muted); margin: 0; font-size: 0.875rem;">Configure initial account status and verification settings</p>
                    </div>
                    
                    <div class="form-card" style="background: white; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid var(--admin-border-color); margin-bottom: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div style="display: flex; align-items: center; padding: 1rem; border: 1px solid var(--admin-border-color); border-radius: 0.5rem;">
                                <input type="checkbox" 
                                       id="isActive" 
                                       name="isActive" 
                                       value="1"
                                       checked
                                       style="margin-right: 0.75rem; transform: scale(1.2);">
                                <label for="isActive" style="margin: 0; font-weight: 500;">
                                    <i class="fas fa-user-check" style="margin-right: 0.5rem; color: var(--admin-success);"></i>Active User
                                </label>
                            </div>
                            <div style="display: flex; align-items: center; padding: 1rem; border: 1px solid var(--admin-border-color); border-radius: 0.5rem;">
                                <input type="checkbox" 
                                       id="isVerified" 
                                       name="isVerified" 
                                       value="1"
                                       checked
                                       style="margin-right: 0.75rem; transform: scale(1.2);">
                                <label for="isVerified" style="margin: 0; font-weight: 500;">
                                    <i class="fas fa-envelope-check" style="margin-right: 0.5rem; color: var(--admin-primary);"></i>Email Verified
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- User Role Section -->
                    <div class="section-header" style="margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--admin-text-color); margin: 0 0 0.5rem 0;">
                            <i class="fas fa-user-tag" style="margin-right: 0.5rem; color: var(--admin-info);"></i>
                            User Role
                        </h2>
                        <p style="color: var(--admin-text-muted); margin: 0; font-size: 0.875rem;">Assign user's role and permissions in the system</p>
                    </div>
                    
                    <div class="form-card" style="background: white; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid var(--admin-border-color); margin-bottom: 2rem;">
                        <div style="background-color: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid var(--admin-info);">
                            <i class="fas fa-info-circle" style="color: var(--admin-info); margin-right: 0.5rem;"></i>
                            <strong>Note:</strong> Roles are hierarchical. Select the highest role - it includes all lower permissions.
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div style="padding: 1rem; border: 1px solid var(--admin-border-color); border-radius: 0.5rem;">
                                <input type="radio" 
                                       id="role_member" 
                                       name="role" 
                                       value="ROLE_MEMBER"
                                       checked
                                       style="margin-right: 0.75rem;">
                                <label for="role_member" style="margin: 0; font-weight: 500;">
                                    <i class="fas fa-user" style="margin-right: 0.5rem; color: var(--admin-secondary);"></i>Member
                                </label>
                            </div>
                            <div style="padding: 1rem; border: 1px solid var(--admin-border-color); border-radius: 0.5rem;">
                                <input type="radio" 
                                       id="role_facilitator" 
                                       name="role" 
                                       value="ROLE_FACILITATOR"
                                       style="margin-right: 0.75rem;">
                                <label for="role_facilitator" style="margin: 0; font-weight: 500;">
                                    <i class="fas fa-users-cog" style="margin-right: 0.5rem; color: var(--admin-primary);"></i>Facilitator
                                </label>
                            </div>
                            <div style="padding: 1rem; border: 1px solid var(--admin-border-color); border-radius: 0.5rem;">
                                <input type="radio" 
                                       id="role_supervisor" 
                                       name="role" 
                                       value="ROLE_SUPERVISOR"
                                       style="margin-right: 0.75rem;">
                                <label for="role_supervisor" style="margin: 0; font-weight: 500;">
                                    <i class="fas fa-user-tie" style="margin-right: 0.5rem; color: var(--admin-info);"></i>Supervisor
                                </label>
                            </div>
                            <div style="padding: 1rem; border: 1px solid var(--admin-border-color); border-radius: 0.5rem;">
                                <input type="radio" 
                                       id="role_admin" 
                                       name="role" 
                                       value="ROLE_ADMIN"
                                       style="margin-right: 0.75rem;">
                                <label for="role_admin" style="margin: 0; font-weight: 500;">
                                    <i class="fas fa-crown" style="margin-right: 0.5rem; color: var(--admin-warning);"></i>Administrator
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div style="display: flex; justify-content: flex-end; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid var(--admin-border-color);">
                        <a href="{{ path('admin_users') }}" class="admin-btn admin-btn-secondary">
                            <i class="fas fa-times"></i>
                            Cancel
                        </a>
                        <button type="submit" class="admin-btn admin-btn-primary">
                            <i class="fas fa-save"></i>
                            Create User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
/* Hide Bootstrap validation messages */
.invalid-feedback {
    display: none !important;
}

/* Custom validation styles */
.admin-form-control.is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
}

.admin-form-control.is-valid {
    border-color: #28a745 !important;
    box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirmPassword');
    const form = document.getElementById('userAddForm');
    
    function validatePasswords() {
        const password = passwordField.value;
        const confirmPassword = confirmPasswordField.value;
        
        // Clear previous validation
        passwordField.classList.remove('is-valid', 'is-invalid');
        confirmPasswordField.classList.remove('is-valid', 'is-invalid');
        
        // If both fields are empty, that's invalid (required fields)
        if (!password && !confirmPassword) {
            return false;
        }
        
        // If only one field is filled, that's invalid
        if ((password && !confirmPassword) || (!password && confirmPassword)) {
            if (password && !confirmPassword) {
                confirmPasswordField.classList.add('is-invalid');
            }
            if (!password && confirmPassword) {
                passwordField.classList.add('is-invalid');
            }
            return false;
        }
        
        // If both fields are filled, validate
        if (password && confirmPassword) {
            if (password.length < 6) {
                passwordField.classList.add('is-invalid');
                return false;
            }
            
            if (password !== confirmPassword) {
                confirmPasswordField.classList.add('is-invalid');
                return false;
            }
            
            passwordField.classList.add('is-valid');
            confirmPasswordField.classList.add('is-valid');
        }
        
        return true;
    }
    
    // Add event listeners
    passwordField.addEventListener('input', validatePasswords);
    confirmPasswordField.addEventListener('input', validatePasswords);
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        // Basic form validation
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const email = document.getElementById('email').value.trim();
        
        let isValid = true;
        
        // Validate required fields
        if (!firstName) {
            document.getElementById('firstName').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('firstName').classList.remove('is-invalid');
        }
        
        if (!lastName) {
            document.getElementById('lastName').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('lastName').classList.remove('is-invalid');
        }
        
        if (!email || !email.includes('@')) {
            document.getElementById('email').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('email').classList.remove('is-invalid');
        }
        
        // Validate passwords
        if (!validatePasswords()) {
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            e.stopPropagation();
        }
    });
});
</script>
{% endblock %}